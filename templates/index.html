<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نظام إدارة الطلاب</title>
    <style>
        body {
            font-family: "Cairo", sans-serif;
            background-color: #f6f6f6;
            padding: 30px;
            direction: rtl;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .form-section, .list-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        label { display: block; margin-top: 10px; }
        input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        button {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        .actions button {
            background-color: #dc3545;
            margin-left: 5px;
        }
        .actions button.update {
            background-color: #28a745;
        }
    </style>
</head>
<body>

    <h1>نظام إدارة الطلاب</h1>

    <div class="form-section">
        <h2>إضافة / تعديل طالب</h2>
        <label>رقم الطالب (ID):</label>
        <input type="number" id="studentId" placeholder="مثال: 1">

        <label>الاسم:</label>
        <input type="text" id="studentName" placeholder="مثال: أحمد محمد">

        <label>الدرجة:</label>
        <input type="number" id="studentGrade" placeholder="مثال: 90">

        <button onclick="createOrUpdateStudent()">حفظ</button>
    </div>

    <div class="list-section">
        <h2>قائمة الطلاب</h2>
        <table id="studentsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>الاسم</th>
                    <th>الدرجة</th>
                    <th>التحكم</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // ✅ ربط فعلي بسيرفرك على Render
        const API_URL = "https://fastapi-tutorial2-46xo.onrender.com/students/";

        async function fetchStudents() {
            try {
                const response = await fetch(API_URL);
                const students = await response.json();
                const tableBody = document.querySelector("#studentsTable tbody");
                tableBody.innerHTML = "";
                students.forEach(s => {
                    const row = `
                        <tr>
                            <td>${s.id}</td>
                            <td>${s.name}</td>
                            <td>${s.grade}</td>
                            <td class="actions">
                                <button class="update" onclick="loadStudent(${s.id})">تعديل</button>
                                <button onclick="deleteStudent(${s.id})">حذف</button>
                            </td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            } catch (error) {
                alert("تعذر تحميل البيانات من السيرفر");
                console.error(error);
            }
        }

        async function createOrUpdateStudent() {
            const id = document.getElementById("studentId").value;
            const name = document.getElementById("studentName").value;
            const grade = document.getElementById("studentGrade").value;

            if (!id || !name || !grade) {
                alert("من فضلك أدخل كل البيانات");
                return;
            }

            const student = { id: parseInt(id), name, grade: parseInt(grade) };

            try {
                const existing = await fetch(API_URL);
                const students = await existing.json();
                const found = students.find(s => s.id == id);

                if (found) {
                    await fetch(API_URL + id, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(student)
                    });
                    alert("تم تحديث بيانات الطالب بنجاح");
                } else {
                    await fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(student)
                    });
                    alert("تم إضافة الطالب بنجاح");
                }

                clearForm();
                fetchStudents();
            } catch (error) {
                alert("حدث خطأ أثناء حفظ البيانات");
                console.error(error);
            }
        }

        async function deleteStudent(id) {
            if (confirm("هل أنت متأكد من حذف هذا الطالب؟")) {
                try {
                    await fetch(API_URL + id, { method: "DELETE" });
                    fetchStudents();
                } catch (error) {
                    alert("حدث خطأ أثناء الحذف");
                    console.error(error);
                }
            }
        }

        async function loadStudent(id) {
            try {
                const response = await fetch(API_URL);
                const students = await response.json();
                const student = students.find(s => s.id == id);
                if (student) {
                    document.getElementById("studentId").value = student.id;
                    document.getElementById("studentName").value = student.name;
                    document.getElementById("studentGrade").value = student.grade;
                }
            } catch (error) {
                alert("تعذر تحميل بيانات الطالب");
            }
        }

        function clearForm() {
            document.getElementById("studentId").value = "";
            document.getElementById("studentName").value = "";
            document.getElementById("studentGrade").value = "";
        }

        fetchStudents();
    </script>
</body>
</html>
